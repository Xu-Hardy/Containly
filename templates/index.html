<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Containly 容器面板</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<div id="toast-container" style="
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 9999;
"></div>

<div class="top-bar">
  <h1>Containly 容器面板</h1>
  <label for="host-ip">宿主机 IP：</label>
  <input type="text" id="host-ip" placeholder="例如 192.168.1.100" />
  <a href="/blacklist" class="blacklist-link">黑名单管理</a>
  <button class="dark-toggle" id="darkBtn">🌙</button>
</div>

{% for status, containers in grouped.items() %}
<div class="section" data-status="{{ status }}">
  <h2>{{ status|capitalize }} 容器</h2>
  <div class="grid">
    {% for c in containers %}
    <div class="card"
         data-container-id="{{ c.id }}"
         data-container-name="{{ c.name }}"
         data-protocol="http">
      <div class="card-actions">
        {% if c.status == "running" %}
        <button class="action-btn stop-btn" data-id="{{ c.id }}" title="停止容器">🛑</button>
        <button class="action-btn restart-btn" data-id="{{ c.id }}" title="重启容器">🔄</button>
        <button class="action-btn logs-btn" data-id="{{ c.id }}" title="查看日志">📋</button>
        {% elif c.status == "exited" %}
        <button class="action-btn start-btn" data-id="{{ c.id }}" title="启动容器">▶️</button>
        <button class="action-btn logs-btn" data-id="{{ c.id }}" title="查看日志">📋</button>
        {% endif %}
        <button class="action-btn protocol-btn" title="切换协议">🔐</button>
        <button class="action-btn blacklist-btn" title="加入黑名单">🚫</button>
      </div>

      <h3>{{ c.name }}</h3>
      <div class="tag {{ 'host' if c.network == 'host' else '' }}">{{ c.network }}</div>
      
      <!-- 资源使用情况 -->
      {% if c.status == "running" %}
      <div class="resource-usage">
        <div class="resource-bar">
          <div class="resource-fill" style="width: {{ c.cpu_usage }}%"></div>
        </div>
        <div class="resource-text">CPU: {{ c.cpu_usage }}%</div>
        
        <div class="resource-bar">
          <div class="resource-fill" style="width: {{ c.memory_usage }}%"></div>
        </div>
        <div class="resource-text">内存: {{ c.memory_usage }}%</div>
      </div>
      {% endif %}
      
      <div class="port-list">
        {% for p in c.ports %}
        <div class="port-item" data-host="{{ p.host_port }}" data-container="{{ p.container_port }}">
          Host: <span class="copyable host-port">{{ p.host_port }}</span> |
          Container: <span class="copyable container-port">{{ p.container_port }}</span> –
          <a href="#" class="port-link" target="_blank">跳转</a>
          <span class="status-indicator" title="检测中..."></span>
        </div>
        {% endfor %}
        
        {% if not c.ports %}
        <div class="port-item">无端口映射</div>
        {% endif %}
      </div>
    </div>
    {% endfor %}
    
    {% if not containers %}
    <div class="empty-state">没有{{ status }}状态的容器</div>
    {% endif %}
  </div>
</div>
{% endfor %}

<!-- 日志查看器 -->
<div class="log-viewer">
  <div class="log-header">
    <h2>容器日志</h2>
    <button class="log-close">&times;</button>
  </div>
  <div class="log-content"></div>
</div>

<script src="/static/js/main.js"></script>
</body>
</html>
